{% extends "admin/base_site.html" %}
{% block content %}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<div class="container-fluid px-4">
    <h1 class="my-4">Dashboard Overview</h1>

    <div class="row g-4">
        {% for label, value, url in cards %}
        <div class="col-sm-6 col-md-4 col-lg-3">
            <div class="card shadow-sm h-100 border-0">
                <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
                    <h5 class="card-title">
                        <a href="{% url url %}" class="stretched-link text-decoration-none text-dark fw-semibold">
                            {{ label }}
                        </a>
                    </h5>
                    <p class="display-6 fw-bold mt-2">{{ value }}</p>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>

    <div class="mt-5">
        <h2 class="mb-3">Monthly Payments</h2>
        <canvas id="paymentsChart" width="400" height="150" class="w-100"></canvas>
    </div>

    <div class="mt-5">
        <h2 class="mb-3">Top-Selling Products</h2>
        <ul class="list-group">
            {% for item in top_products %}
            <li class="list-group-item d-flex justify-content-between align-items-center">
                {{ item.product__name }}
                <span class="badge bg-primary rounded-pill">{{ item.total_sold }}</span>
            </li>
            {% empty %}
            <li class="list-group-item">No data available.</li>
            {% endfor %}
        </ul>
    </div>

    <div class="alert alert-warning mt-4" role="alert">
        ðŸ§¾ {{ unpaid_count }} unpaid invoices, totaling â‚¹{{ unpaid_total }}
    </div>

    <div class="mt-5">
        <h2 class="mb-3">Upcoming Recurring Expenses</h2>
        <ul class="list-group">
            {% for e in upcoming_expenses %}
            <li class="list-group-item">
                <strong>{{ e.title }}</strong> â€” â‚¹{{ e.amount }} on {{ e.date }}
            </li>
            {% empty %}
            <li class="list-group-item">No upcoming expenses.</li>
            {% endfor %}
        </ul>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('paymentsChart').getContext('2d');
    const paymentsChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: JSON.parse('{{ labels|escapejs }}'),
            datasets: [{
                label: 'Payments',
                data: JSON.parse('{{ totals|escapejs }}'),
                backgroundColor: 'rgba(13, 110, 253, 0.2)',
                borderColor: 'rgba(13, 110, 253, 1)',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    display: false
                }
            },
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>
{% endblock %}
